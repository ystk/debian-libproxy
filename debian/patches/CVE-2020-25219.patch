--- libproxy-0.4.11.orig/libproxy/url.cpp
+++ libproxy-0.4.11/libproxy/url.cpp
@@ -34,6 +34,7 @@
 #include <sys/stat.h> // For stat()
 #include <algorithm> // For transform()
 #include <unistd.h>  // For read() close()
+#include <errno.h>  // EINTR
 
 #ifdef WIN32
 #include <io.h>
@@ -370,16 +371,24 @@ string url::to_string() const {
 	return m_orig;
 }
 
-static inline string recvline(int fd) {
-	// Read a character.
-	// If we don't get a character, return empty string.
-	// If we are at the end of the line, return empty string.
-	char c = '\0';
-	
-	if (recv(fd, &c, 1, 0) != 1 || c == '\n')
-		return "";
+static string recvline(int fd) {
+	string line;
+	int ret;
+
+	// Reserve arbitrary amount of space to avoid small memory reallocations.
+	line.reserve(128);
+
+	do {
+		char c;
+		ret = recv(fd, &c, 1, 0);
+		if (ret == 1) {
+			if (c == '\n')
+				return line;
+			line += c;
+		}
+	} while (ret == 1 || (ret == -1 && errno == EINTR));
 
-	return string(1, c) + recvline(fd);
+	return line;
 }
 
 char* url::get_pac() {
